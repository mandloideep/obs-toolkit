<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CTA Overlay</title>
<!--
  CALL TO ACTION OVERLAY
  ======================
  Params:
    preset   = subscribe | like | follow | share | notify | custom  (default: subscribe)
    text     = custom text (overrides preset)
    sub      = subtitle text
    size     = font size px                              (default: 28)
    theme, gradient
    bg       = true|false                                (default: true)
    align    = left|center|right                         (default: center)
    valign   = top|center|bottom                         (default: bottom)
    
    Animation:
    entrance = bounce|slideUp|slideLeft|fade|scale       (default: bounce)
    exit     = fade|slideDown|scale|none                 (default: fade)
    loop     = true|false                                (default: true)
    hold     = seconds visible                           (default: 6)
    pause    = seconds hidden                            (default: 20)
    delay    = initial delay                             (default: 0.5)
    
    Icon:
    icon     = like|sub|bell|share|heart|star|follow|none (default: from preset)
    iconanim = bounce|shake|pulse|spin|none              (default: bounce)

  Examples:
    cta.html?preset=subscribe&loop=true&hold=8&pause=30
    cta.html?preset=like&gradient=sunset&iconanim=shake
    cta.html?text=Follow%20for%20more!&icon=follow&entrance=slideUp
-->
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:transparent;overflow:hidden;width:100vw;height:100vh;display:flex;font-family:var(--ff)}
  
  .cta{display:flex;align-items:center;gap:14px;padding:16px 28px;opacity:0;transform:translateY(20px);transition:all 0.5s cubic-bezier(.34,1.56,.64,1)}
  .cta.has-bg{background:var(--pbg);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-radius:14px;border:1px solid var(--pbr);box-shadow:0 4px 24px rgba(0,0,0,.25)}
  .cta.visible{opacity:1;transform:translateY(0)}

  /* Icon positioning */
  .cta.icon-left{flex-direction:row}
  .cta.icon-right{flex-direction:row-reverse}
  .cta.icon-top{flex-direction:column}
  .cta.icon-bottom{flex-direction:column-reverse}

  .cta-icon{flex-shrink:0;display:flex;align-items:center;justify-content:center}
  .cta-icon svg{width:var(--isz);height:var(--isz);color:var(--ic)}

  .cta-text{display:flex;flex-direction:column;gap:2px;padding:var(--tpy) var(--tpx)}
  .cta-main{color:var(--tc);font-size:var(--fs);font-weight:700;letter-spacing:var(--ls);line-height:var(--lh);white-space:nowrap}
  .cta-sub{color:var(--tm);font-size:calc(var(--fs)*0.6);font-weight:400;white-space:nowrap}
  
  .cta-line{height:2px;background:linear-gradient(90deg,var(--gc));border-radius:1px;margin-top:4px;transform:scaleX(0);transform-origin:left;transition:transform 0.8s ease-out 0.3s}
  .cta.visible .cta-line{transform:scaleX(1)}
  
  /* Icon animations */
  .icon-bounce svg{animation:iBounce 0.6s ease-out 0.4s both}
  .icon-shake svg{animation:iShake 0.5s ease-out 0.4s both}
  .icon-pulse svg{animation:iPulse 1.5s ease-in-out infinite}
  .icon-spin svg{animation:iSpin 0.8s ease-out 0.4s both}
  .icon-wiggle svg{animation:iWiggle 0.5s ease-in-out 0.4s both}
  .icon-flip svg{animation:iFlip 0.6s ease-out 0.4s both}
  .icon-heartbeat svg{animation:iHeartbeat 1.2s ease-in-out infinite}

  @keyframes iBounce{0%{transform:scale(0.3)}50%{transform:scale(1.3)}70%{transform:scale(0.9)}100%{transform:scale(1)}}
  @keyframes iShake{0%{transform:rotate(0)}25%{transform:rotate(-15deg)}50%{transform:rotate(15deg)}75%{transform:rotate(-5deg)}100%{transform:rotate(0)}}
  @keyframes iPulse{0%,100%{transform:scale(1);opacity:0.8}50%{transform:scale(1.15);opacity:1}}
  @keyframes iSpin{0%{transform:rotateY(0)}100%{transform:rotateY(360deg)}}
  @keyframes iWiggle{0%,100%{transform:rotate(0)}25%{transform:rotate(10deg)}75%{transform:rotate(-10deg)}}
  @keyframes iFlip{0%{transform:rotateX(0)}50%{transform:rotateX(180deg)}100%{transform:rotateX(360deg)}}
  @keyframes iHeartbeat{0%,100%{transform:scale(1)}14%{transform:scale(1.2)}28%{transform:scale(1)}42%{transform:scale(1.2)}70%{transform:scale(1)}}
  
  /* Entrance variants */
  .entr-bounce{transform:translateY(30px) scale(0.9)}
  .entr-bounce.visible{transform:translateY(0) scale(1)}
  .entr-slideUp{transform:translateY(40px)}
  .entr-slideUp.visible{transform:translateY(0)}
  .entr-slideLeft{transform:translateX(-40px);opacity:0}
  .entr-slideLeft.visible{transform:translateX(0);opacity:1}
  .entr-slideRight{transform:translateX(40px);opacity:0}
  .entr-slideRight.visible{transform:translateX(0);opacity:1}
  .entr-fade{transform:none;opacity:0}
  .entr-fade.visible{opacity:1}
  .entr-scale{transform:scale(0.7);opacity:0}
  .entr-scale.visible{transform:scale(1);opacity:1}
  .entr-flipIn{transform:rotateY(-90deg);opacity:0}
  .entr-flipIn.visible{transform:rotateY(0);opacity:1}
  .entr-zoomIn{transform:scale(0.3);opacity:0}
  .entr-zoomIn.visible{transform:scale(1);opacity:1}

  /* Exit */
  .exiting{transition:all 0.4s ease-in!important}
  .exit-fade{opacity:0!important}
  .exit-slideDown{opacity:0!important;transform:translateY(20px)!important}
  .exit-slideLeft{opacity:0!important;transform:translateX(-30px)!important}
  .exit-slideRight{opacity:0!important;transform:translateX(30px)!important}
  .exit-scale{opacity:0!important;transform:scale(0.8)!important}
  .exit-flipOut{opacity:0!important;transform:rotateY(90deg)!important}

  /* Decorations */
  .deco-line{height:2px;background:var(--dc);border-radius:1px;margin-top:6px;transform:scaleX(0);transform-origin:left}
  .deco-slant{height:2px;background:var(--dc);margin-top:6px;transform:translateX(-100%) skewX(-20deg);transform-origin:left}
  .deco-swirl{margin-top:6px;height:12px}
  .visible .deco-line,.visible .deco-slant{transform:none!important;transition:transform 0.6s ease-out 0.4s}
</style>
</head>
<body>
<script src="brand.js"></script>
<script src="brand-helpers.js"></script>
<script src="preview-wrapper.js"></script>
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
<script>
const CTA_ICONS = {
  like: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M2 21h2V9H2v12zm20-9c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L13.17 3 7.59 8.59C7.22 8.95 7 9.45 7 10v9c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>`,
  sub: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 10l-4 4l6 6l4-16l-18 7l4 2l2 6l3-4"/></svg>`,
  bell: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>`,
  share: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>`,
  heart: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>`,
  star: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`,
  follow: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>`,
};

const PRESETS = {
  subscribe: { text:'Subscribe', sub:'Don\'t miss out!', icon:'sub', iconanim:'bounce' },
  like:      { text:'Like this stream', sub:'It helps a lot!', icon:'like', iconanim:'shake' },
  follow:    { text:'Follow', sub:'Stay connected', icon:'follow', iconanim:'bounce' },
  share:     { text:'Share with a friend', sub:'', icon:'share', iconanim:'spin' },
  notify:    { text:'Turn on notifications', sub:'Never miss a stream', icon:'bell', iconanim:'shake' },
  custom:    {},
};

const preset = $.str('preset','subscribe');
const P = PRESETS[preset] || PRESETS.subscribe;

const t = $.theme(), g = $.gradient(), ac = $.accents();

const cfg = {
  text:     $.str('text', P.text||'Subscribe'),
  sub:      $.str('sub', P.sub||''),
  size:     $.num('size', 28),
  icon:     $.str('icon', P.icon||'sub'),
  iconAnim: $.str('iconanim', P.iconanim||'bounce'),
  entrance: $.str('entrance','bounce'),
  exit:     $.str('exit','fade'),
  showBg:   $.bool('bg',true),
  align:    $.str('align','center'),
  valign:   $.str('valign','bottom'),
  loop:     $.bool('loop',true),
  hold:     $.num('hold',6),
  pause:    $.num('pause',20),
  delay:    $.num('delay',0.5),

  // Icon customization
  iconpos:      $.str('iconpos','left'),         // left|right|top|bottom
  iconcolor:    $.str('iconcolor',''),           // Custom icon color
  iconsize:     $.num('iconsize',0),             // Explicit size (0=auto)
  customicon:   $.str('customicon',''),          // Any Lucide icon name

  // Text customization
  textpadx:     $.num('textpadx',0),             // Horizontal text padding
  textpady:     $.num('textpady',0),             // Vertical text padding
  letterspacing:$.num('letterspacing',0),        // Letter spacing
  lineheight:   $.num('lineheight',1.2),         // Line height multiplier

  // Decorations
  decoration:   $.str('decoration','line'),      // line|slant|swirl|none
  decorationcolor: $.str('decorationcolor',''),  // Decoration color override
};

$.css('--ff', $.font('display'));
$.css('--fs', cfg.size+'px');
const finalIconSize = cfg.iconsize || Math.round(cfg.size*1.1);
$.css('--isz', finalIconSize+'px');
$.css('--tc', t.text);
$.css('--tm', t.textMuted);
const finalIconColor = cfg.iconcolor || g[0] || ac.primary;
$.css('--ic', finalIconColor);
$.css('--gc', g.join(','));
$.css('--pbg', t.bg+'dd');
$.css('--pbr', t.border);

// Text customization
$.css('--tpx', cfg.textpadx ? cfg.textpadx+'px' : '0px');
$.css('--tpy', cfg.textpady ? cfg.textpady+'px' : '0px');
$.css('--ls', cfg.letterspacing+'px');
$.css('--lh', cfg.lineheight);

// Decoration color
const finalDecoColor = cfg.decorationcolor || g[0] || ac.primary;
$.css('--dc', finalDecoColor);

const vMap={top:'flex-start',center:'center',bottom:'flex-end'};
const hMap={left:'flex-start',center:'center',right:'flex-end'};
document.body.style.alignItems = vMap[cfg.valign]||'flex-end';
document.body.style.justifyContent = hMap[cfg.align]||'center';

// Build
const el = document.createElement('div');
el.className = `cta icon-${cfg.iconpos} entr-${cfg.entrance}` + (cfg.showBg ? ' has-bg' : '');

if (cfg.icon !== 'none') {
  const iconEl = document.createElement('div');
  iconEl.className = `cta-icon icon-${cfg.iconAnim}`;

  if (cfg.customicon) {
    // Use Lucide custom icon
    const lucideIcon = $.icon(cfg.customicon, cfg.iconsize || Math.round(cfg.size*1.1), finalIconColor, CTA_ICONS[cfg.icon]);
    iconEl.appendChild(lucideIcon);
  } else if (CTA_ICONS[cfg.icon]) {
    // Use embedded SVG
    iconEl.innerHTML = CTA_ICONS[cfg.icon];
  }

  el.appendChild(iconEl);
}

const textWrap = document.createElement('div');
textWrap.className = 'cta-text';

const mainEl = document.createElement('div');
mainEl.className = 'cta-main';
mainEl.textContent = cfg.text;
textWrap.appendChild(mainEl);

if (cfg.sub) {
  const subEl = document.createElement('div');
  subEl.className = 'cta-sub';
  subEl.textContent = cfg.sub;
  textWrap.appendChild(subEl);
}

// Add decoration if not 'none'
if (cfg.decoration !== 'none') {
  if (cfg.decoration === 'swirl') {
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('class', 'deco-swirl');
    svg.setAttribute('width', '60');
    svg.setAttribute('height', '12');
    svg.setAttribute('viewBox', '0 0 60 12');
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', 'M2,6 Q8,2 15,6 T30,6 Q38,10 45,6 Q50,4 55,6');
    path.setAttribute('stroke', finalDecoColor);
    path.setAttribute('stroke-width', '2');
    path.setAttribute('fill', 'none');
    path.setAttribute('stroke-linecap', 'round');
    svg.appendChild(path);
    textWrap.appendChild(svg);
  } else {
    const decoEl = document.createElement('div');
    decoEl.className = `deco-${cfg.decoration}`;
    textWrap.appendChild(decoEl);
  }
}

el.appendChild(textWrap);
document.body.appendChild(el);

// Animation
function show() {
  el.classList.remove('exiting','exit-fade','exit-slideDown','exit-scale','exit-slideLeft','exit-slideRight','exit-flipOut');
  el.classList.add('visible');
  // Re-trigger icon animation
  const iconSvg = el.querySelector('.cta-icon svg');
  if (iconSvg) { iconSvg.style.animation='none'; iconSvg.offsetHeight; iconSvg.style.animation=''; }
  // Re-trigger line
  line.style.transform='scaleX(0)'; line.offsetHeight; line.style.transform='';
}

function hide(cb) {
  el.classList.add('exiting');
  if (cfg.exit!=='none') el.classList.add('exit-'+cfg.exit);
  setTimeout(() => {
    el.classList.remove('visible','exiting','exit-fade','exit-slideDown','exit-scale');
    if (cb) cb();
  }, 500);
}

if (cfg.loop) {
  function cycle() {
    show();
    setTimeout(() => {
      hide(() => setTimeout(cycle, cfg.pause*1000));
    }, cfg.hold*1000);
  }
  setTimeout(cycle, cfg.delay*1000);
} else {
  setTimeout(show, cfg.delay*1000);
}
</script>
</body>
</html>
